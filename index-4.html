<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>PredictShot — Web (400x400, Border, No Skill)</title>
  <style>
    :root{
      --hud-gap: 10px;
      --pad-size: clamp(120px, 28vw, 180px);
      --safe-bot: env(safe-area-inset-bottom, 8px);
    }
    html,body{margin:0;height:100%;background:#0b0f14;color:#e6e6e6;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    #app{position:fixed;inset:0;display:grid;grid-template-rows:1fr auto;}
    /* Game area */
    #gameWrap{position:relative;display:grid;place-items:center;padding:6px 6px calc(var(--safe-bot) + 6px);}
    canvas#gameCanvas{
      width:min(100vw,100vh);
      height:min(100vw,100vh);
      max-width:100vmin;max-height:100vmin;
      background:#000;border-radius:8px;
      border:2px solid #60a5fa; /* 테두리 표시 */
      box-shadow:0 6px 20px rgba(0,0,0,.6);
      image-rendering:pixelated;
    }
    /* Bottom HUD (joystick only) */
    #hudBar{
      position:sticky;bottom:0;display:flex;align-items:center;justify-content:flex-start;
      gap:var(--hud-gap);padding:8px 10px calc(var(--safe-bot) + 8px);
      background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(10,14,18,.65) 25%, rgba(10,14,18,.85) 100%);
      backdrop-filter:blur(6px);
    }
    .pad{position:relative;width:var(--pad-size);height:var(--pad-size);border-radius:50%;
      background:rgba(255,255,255,.06);border:2px solid rgba(255,255,255,.12);touch-action:none;user-select:none;}
    .stick{position:absolute;left:50%;top:50%;width:40%;height:40%;transform:translate(-50%,-50%);border-radius:50%;
      background:rgba(255,255,255,.25);border:2px solid rgba(255,255,255,.35);box-shadow:0 4px 12px rgba(0,0,0,.45);}    
  </style>
</head>
<body>
  <div id="app">
    <div id="gameWrap">
      <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>
    <div id="hudBar">
      <div id="pad" class="pad"><div id="stick" class="stick"></div></div>
    </div>
  </div>

  <script>
    // Platform tag for leaderboard split (if needed)
    window.PLATFORM = 'web-portrait-400-noskill';

    // Fit square canvas
    (function(){
      const canvas = document.getElementById('gameCanvas');
      const fit = ()=>{
        const size = Math.min(window.innerWidth, window.innerHeight * 0.74);
        canvas.style.width = size+'px';
        canvas.style.height = size+'px';
      };
      window.addEventListener('resize', fit, {passive:true});
      window.addEventListener('orientationchange', ()=>setTimeout(fit,200));
      fit();
    })();

    // Virtual joystick -> Arrow/WASD + analog axes
    const MobileInput = (()=>{
      const pad = document.getElementById('pad');
      const stick = document.getElementById('stick');
      const state = {ax:0, ay:0, active:false};
      const dead = 0.12, th = 0.2;
      const center = ()=>{const r = pad.getBoundingClientRect(); return {x:r.left+r.width/2,y:r.top+r.height/2,rad:r.width/2}};
      function setAxis(nx,ny){
        const len = Math.hypot(nx,ny)||0, k = len>1?1/len:1; const ax=nx*k, ay=ny*k;
        state.ax = Math.abs(ax)<dead?0:ax; state.ay = Math.abs(ay)<dead?0:ay;
        stick.style.transform = `translate(calc(-50% + ${state.ax*40}%), calc(-50% + ${state.ay*40}%))`;
        emitKeysFromAxes(state.ax, state.ay);
      }
      function onPointer(e){ const c=center(); const p=(e.touches?e.touches[0]:e); setAxis((p.clientX-c.x)/c.rad,(p.clientY-c.y)/c.rad); }
      function start(e){ state.active=true; onPointer(e); }
      function move(e){ if(state.active) onPointer(e); }
      function end(){ state.active=false; setAxis(0,0); }
      pad.addEventListener('touchstart',start,{passive:false});
      pad.addEventListener('touchmove', move,{passive:false});
      pad.addEventListener('touchend',  end,{passive:false});
      pad.addEventListener('touchcancel',end,{passive:false});
      pad.addEventListener('pointerdown',start); pad.addEventListener('pointermove',move); pad.addEventListener('pointerup',end); pad.addEventListener('pointerleave',end);

      let held={};
      function fire(code,type){ window.dispatchEvent(new KeyboardEvent(type,{key:code,code,bubbles:true})); }
      function setHeld(k,v,key){ if(held[k]!==v){ held[k]=v; fire(key, v?'keydown':'keyup'); } }
      function emitKeysFromAxes(x,y){
        setHeld('L', x<-th, 'ArrowLeft'); setHeld('R', x>th, 'ArrowRight'); setHeld('U', y<-th, 'ArrowUp'); setHeld('D', y>th, 'ArrowDown');
        setHeld('LA',x<-th,'KeyA'); setHeld('RD',x>th,'KeyD'); setHeld('UW',y<-th,'KeyW'); setHeld('DS',y>th,'KeyS');
      }
      return { getAxis:()=>({x:state.ax,y:state.ay}) };
    })();
    window.MobileInput = MobileInput;
  </script>
  <script src="./game.js"></script>
</body>
</html>
